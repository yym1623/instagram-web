import{g as D,E as G,s as J,b as I,w as F,N,T as W,o as n,c as o,A as S,a as e,n as l,y as M,B as P,C as V,F as $,r as B,q as L,t as b,p as y,x as p,v as T,O as X,P as Y,l as Z,k as ee,m as te,Q as se}from"./qrGIMbRh.js";const le={class:"flex items-center justify-between px-4 py-3 border-b border-neutral-200 dark:border-neutral-800"},ae=["disabled"],ne={class:"p-2 border-b border-neutral-200 dark:border-neutral-800"},re={class:"flex items-center gap-2 px-3 py-2 rounded-lg bg-neutral-100 bg-app"},oe={class:"flex-1 overflow-y-auto min-h-0"},ie=["onClick"],de={class:"min-w-0 flex-1"},ue={class:"text-sm font-semibold text-black dark:text-white truncate"},ce={class:"text-xs text-neutral-500 dark:text-neutral-400 truncate"},xe={key:0,class:"text-blue-500 dark:text-blue-400"},pe={key:0,class:"py-8 text-center text-sm text-neutral-500 dark:text-neutral-400"},fe=D({__name:"MessageSend",props:{open:{type:Boolean},allUsers:{},currentUserId:{}},emits:["close","select"],setup(v,{emit:i}){const u=v,_=i,f=p(""),x=p(null),h=T(()=>{if(!f.value.trim())return u.allUsers;const c=f.value.trim().toLowerCase();return u.allUsers.filter(s=>s.name.toLowerCase().includes(c)||s.nickname&&s.nickname.toLowerCase().includes(c)||s.email&&s.email.toLowerCase().includes(c))}),C=T(()=>!!x.value);function U(c){c.id!==u.currentUserId&&(x.value=x.value?.id===c.id?null:c)}function m(){x.value&&(_("select",x.value),x.value=null,f.value="",_("close"))}function w(){x.value=null,f.value="",_("close")}return G(()=>u.open,c=>{c||(x.value=null,f.value="")}),(c,s)=>(n(),J(W,{to:"body"},[I(N,{"enter-active-class":"transition-opacity duration-200","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"transition-opacity duration-150","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:F(()=>[v.open?(n(),o("div",{key:0,class:"fixed inset-0 z-[200] flex items-center justify-center bg-black/25 p-4",onClick:S(w,["self"])},[I(N,{"enter-active-class":"transition-all duration-200 ease-out","enter-from-class":"opacity-0 scale-95","enter-to-class":"opacity-100 scale-100","leave-active-class":"transition-all duration-150 ease-in","leave-from-class":"opacity-100 scale-100","leave-to-class":"opacity-0 scale-95"},{default:F(()=>[v.open?(n(),o("div",{key:0,class:"w-full max-w-[400px] max-h-[80vh] flex flex-col rounded-xl overflow-hidden bg-[rgb(33,35,40)] border border-neutral-200 dark:border-neutral-700 shadow-xl",onClick:s[1]||(s[1]=S(()=>{},["stop"]))},[e("div",le,[e("button",{type:"button",class:"text-black dark:text-white hover:opacity-70",onClick:w},[...s[2]||(s[2]=[e("i",{class:"fa-solid fa-xmark text-xl"},null,-1)])]),s[3]||(s[3]=e("span",{class:"font-semibold text-black dark:text-white"},"새 메시지",-1)),e("button",{type:"button",class:"text-sm font-semibold disabled:opacity-40 disabled:cursor-not-allowed text-blue-500 dark:text-blue-400 hover:opacity-80",disabled:!l(C),onClick:m}," 다음 ",8,ae)]),e("div",ne,[e("div",re,[s[4]||(s[4]=e("i",{class:"fa-solid fa-magnifying-glass text-neutral-400"},null,-1)),M(e("input",{"onUpdate:modelValue":s[0]||(s[0]=d=>V(f)?f.value=d:null),type:"text",placeholder:"검색...",class:"flex-1 bg-transparent border-0 outline-none text-sm text-black dark:text-white placeholder-neutral-500"},null,512),[[P,l(f)]])])]),e("div",oe,[s[7]||(s[7]=e("div",{class:"py-1 text-xs font-semibold text-neutral-500 dark:text-neutral-400 px-4 pt-3"}," 회원 ",-1)),(n(!0),o($,null,B(l(h),d=>(n(),o("div",{key:d.id,class:L(["flex items-center gap-3 px-4 py-2.5 cursor-pointer transition-colors",d.id===v.currentUserId?"opacity-50 cursor-default":l(x)?.id===d.id?"bg-white/10":"hover:bg-neutral-50 dark:hover:bg-neutral-800/50"]),onClick:k=>U(d)},[s[6]||(s[6]=e("div",{class:"w-11 h-11 rounded-full bg-neutral-200 dark:bg-neutral-600 flex-shrink-0"},null,-1)),e("div",de,[e("div",ue,b(d.nickname||d.name),1),e("div",ce,b(d.name),1)]),l(x)?.id===d.id?(n(),o("div",xe,[...s[5]||(s[5]=[e("i",{class:"fa-solid fa-check"},null,-1)])])):y("",!0)],10,ie))),128)),l(h).length===0?(n(),o("div",pe," 검색 결과가 없습니다. ")):y("",!0)])])):y("",!0)]),_:1})])):y("",!0)]),_:1})]))}}),me=Object.assign(fe,{__name:"ModalsMessageSend"}),be=globalThis.setInterval;let g=null;function ve(){const v=Y();return g||X(()=>import("./Cl_BsGI8.js"),[],import.meta.url).then(i=>{const u=i.io;g=u(v.public.socketUrl,{transports:["websocket"]})}),{get socket(){return g},whenReady(){return new Promise(i=>{if(g){i(g);return}const u=be(()=>{g&&(clearInterval(u),i(g))},50)})}}}const ke={class:"message w-full h-full min-h-0 flex overflow-hidden"},ge={class:"flex items-center h-[60px] px-3 border-b border-neutral-200 dark:border-neutral-800 shrink-0"},ye={class:"flex-1 flex items-center justify-start cursor-pointer min-w-0"},he={class:"font-semibold text-black dark:text-white truncate"},we={class:"text-sm text-neutral-500 dark:text-neutral-400 ml-2"},_e={class:"shrink-0 px-2 py-2"},Ce={class:"flex items-center gap-2 px-3 py-2 rounded-lg bg-neutral-100 bg-app"},Ue={class:"flex-1 overflow-y-auto"},$e=["onClick"],Le={class:"min-w-0 flex-1"},je={class:"text-sm font-semibold text-black dark:text-white truncate"},Ie={key:0,class:"py-8 text-center text-sm text-neutral-500 dark:text-neutral-400"},Se={key:0,class:"flex-1 flex items-center justify-center p-6 bg-app min-h-0"},Me={class:"flex items-center justify-between h-[60px] px-4 border-b border-neutral-200 dark:border-neutral-800 shrink-0"},Pe={class:"flex items-center gap-3 min-w-0"},Ve={class:"font-bold text-black dark:text-white truncate"},Be={class:"flex-1 overflow-y-auto p-5"},Te=["src"],Ae={key:1},Oe={class:"p-4 border-t border-neutral-200 dark:border-neutral-800 shrink-0"},Re={class:"flex items-center gap-2 border border-neutral-200 dark:border-neutral-700 rounded-full pl-4 pr-2 h-11 bg-transparent"},qe=["onKeydown"],Ne=D({__name:"message",setup(v){const i=Z(),{post:u,imageUrl:_}=ee(),f=p([]),x=p([]),h=p(null),C=p(""),U=p([]),m=p(""),w=p(!1),c=p(!1),s=p(!1),d=p(!1),k=p(""),{whenReady:A}=ve();te(()=>{K(),Q()});async function K(){const r=await u("/users/select",{name:i.name});f.value=r??[]}async function Q(){const r=await u("/users",{email:i.email});x.value=(r??[]).filter(t=>t.id!==i.id)}const O=T(()=>{if(!k.value.trim())return f.value;const r=k.value.trim().toLowerCase();return f.value.filter(t=>t.name.toLowerCase().includes(r)||t.nickname&&t.nickname.toLowerCase().includes(r))});async function R(r){h.value=r,c.value=!0,w.value=!1,s.value=!0;const t=await u("/messages/list",{my_idx:i.id,idx:r.id});C.value=t;const j=await u("/messages/select",{idx:t});U.value=j??[]}function z(){w.value=!0,c.value=!1}function q(){d.value=!0}function H(r){d.value=!1,R({id:r.id,name:r.name,email:r.email??""})}async function E(){if(!h.value||!A)return;const r=await A();r&&(r.emit("chat",{msg:m.value,idx:C.value,my_idx:i.id,img:""}),m.value="",r.on("test",async()=>{const t=await u("/messages/select",{idx:C.value});U.value=t??[]}))}return(r,t)=>{const j=me;return n(),o($,null,[e("div",ke,[e("aside",{class:L(["w-full max-w-[350px] min-w-[280px] border-r border-neutral-200 dark:border-neutral-800 flex flex-col overflow-hidden bg-app",{hidden:l(c)}])},[e("div",ge,[e("div",ye,[e("span",he,b(l(i).nickname),1),e("span",we,b(l(i).name),1)]),e("button",{type:"button",class:"shrink-0 w-10 h-10 flex items-center justify-center text-black dark:text-white hover:bg-neutral-100 dark:hover:bg-neutral-800 rounded-full","aria-label":"새 메시지",onClick:q},[...t[3]||(t[3]=[e("i",{class:"fa-regular fa-pen-to-square text-xl"},null,-1)])])]),e("div",_e,[e("div",Ce,[t[4]||(t[4]=e("i",{class:"fa-solid fa-magnifying-glass text-neutral-400 text-sm"},null,-1)),M(e("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>V(k)?k.value=a:null),type:"search",placeholder:"검색",class:"flex-1 bg-transparent border-0 outline-none text-sm text-black dark:text-white placeholder-neutral-500"},null,512),[[P,l(k)]])])]),t[7]||(t[7]=e("div",{class:"shrink-0 flex items-center justify-between px-3 py-3"},[e("span",{class:"text-sm font-semibold text-black dark:text-white"},"메시지"),e("span",{class:"text-sm font-semibold text-neutral-500 dark:text-neutral-400"},"요청")],-1)),e("div",Ue,[(n(!0),o($,null,B(l(O),a=>(n(),o("div",{key:a.id,class:"flex items-center gap-3 px-3 py-2.5 cursor-pointer hover:bg-neutral-50 dark:hover:bg-neutral-800/50",onClick:Ee=>R({id:a.id,name:a.name,email:a.email??""})},[t[6]||(t[6]=e("div",{class:"w-14 h-14 rounded-full bg-neutral-200 dark:bg-neutral-600 flex-shrink-0"},null,-1)),e("div",Le,[e("div",je,b(a.nickname||a.name)+"님 ",1),t[5]||(t[5]=e("div",{class:"text-sm text-neutral-500 dark:text-neutral-400 truncate"}," 메시지를 보내보세요 ",-1))])],8,$e))),128)),l(O).length===0?(n(),o("div",Ie,b(l(k)?"검색 결과가 없습니다.":"팔로우한 사람이 없습니다."),1)):y("",!0)])],2),l(s)?(n(),o("div",{key:1,class:L(["flex-1 flex flex-col min-w-0 bg-app",{hidden:l(w)}])},[e("header",Me,[e("div",Pe,[e("button",{class:"lg:hidden shrink-0 w-10 h-10 flex items-center justify-center text-black dark:text-white hover:bg-neutral-100 dark:hover:bg-neutral-800 rounded-full","aria-label":"뒤로",onClick:z},[...t[11]||(t[11]=[e("i",{class:"fa-solid fa-chevron-left"},null,-1)])]),e("span",Ve,b(l(h)?.name),1)]),t[12]||(t[12]=e("div",{class:"flex gap-2 text-black dark:text-white shrink-0"},[e("i",{class:"fa-solid fa-phone cursor-pointer hover:opacity-70"}),e("i",{class:"fa-solid fa-video cursor-pointer hover:opacity-70"}),e("i",{class:"fa-solid fa-circle-info cursor-pointer hover:opacity-70"})],-1))]),e("div",Be,[(n(!0),o($,null,B(l(U),a=>(n(),o("div",{key:a.id,class:L(["py-2.5 flex",a.my_id===l(i).id?"justify-end":"justify-start"])},[e("div",{class:L(["max-w-[250px] rounded-2xl px-4 py-3 text-sm",a.my_id===l(i).id?"bg-neutral-200 dark:bg-neutral-700 text-black dark:text-white":"border border-neutral-200 dark:border-neutral-600 text-black dark:text-white"])},[a.img?(n(),o("img",{key:0,src:l(_)(a.img),class:"rounded-lg max-w-[250px] mb-2",alt:""},null,8,Te)):y("",!0),a.msg?(n(),o("span",Ae,b(a.msg),1)):y("",!0)],2)],2))),128))]),e("div",Oe,[e("div",Re,[t[15]||(t[15]=e("i",{class:"fa-regular fa-face-smile text-xl cursor-pointer text-neutral-500 dark:text-neutral-400"},null,-1)),M(e("input",{"onUpdate:modelValue":t[1]||(t[1]=a=>V(m)?m.value=a:null),type:"text",placeholder:"메시지 입력...",class:"flex-1 border-0 outline-none bg-transparent h-8 text-sm text-black dark:text-white placeholder-neutral-400",onKeydown:se(S(E,["prevent"]),["enter"])},null,40,qe),[[P,l(m)]]),l(m).length>0?(n(),o("button",{key:0,class:"text-sm font-bold text-blue-500 dark:text-blue-400 px-3 py-1.5 hover:opacity-80",onClick:E}," 보내기 ")):(n(),o($,{key:1},[t[13]||(t[13]=e("i",{class:"fa-regular fa-image text-xl cursor-pointer px-2 text-neutral-500 dark:text-neutral-400"},null,-1)),t[14]||(t[14]=e("i",{class:"fa-regular fa-heart text-xl cursor-pointer px-2 text-neutral-500 dark:text-neutral-400"},null,-1))],64))])])],2)):(n(),o("div",Se,[e("div",{class:"text-center"},[t[8]||(t[8]=e("div",{class:"text-5xl mb-5 text-neutral-400 dark:text-neutral-500"},[e("i",{class:"fa-regular fa-paper-plane border-2 border-current rounded-full p-4"})],-1)),t[9]||(t[9]=e("div",{class:"text-2xl font-semibold text-neutral-900 dark:text-white"},"내 메시지",-1)),t[10]||(t[10]=e("div",{class:"text-sm text-neutral-500 dark:text-neutral-400 mt-2"}," 친구나 그룹에 비공개 사진과 메시지를 보내보세요. ",-1)),e("button",{type:"button",class:"mt-5 h-9 px-5 text-sm font-bold text-white bg-blue-500 dark:bg-blue-600 rounded-lg cursor-pointer hover:opacity-90 transition-opacity",onClick:q}," 메시지 보내기 ")])]))]),I(j,{open:l(d),"all-users":l(x),"current-user-id":l(i).id,onClose:t[2]||(t[2]=a=>d.value=!1),onSelect:H},null,8,["open","all-users","current-user-id"])],64)}}});export{Ne as default};
